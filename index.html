<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>G√©n√©rateur Solaire Facile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useCallback, useRef, useEffect } = React;

      // üîë MAPBOX - Cr√©e un token gratuit sur https://mapbox.com
      const MAPBOX_TOKEN =
        window.MAPBOX_TOKEN ||
        "pk.eyJ1IjoicXVhbGl3YXR0NTUiLCJhIjoiY21pMnZvdjF1MGoydjJqcXY0Y3hibHppeSJ9.y2nDLEqYLLYqcbfWT62z3g";
      // ‚ö†Ô∏è Remplace par ton vrai token Mapbox (50K requ√™tes gratuites/mois)

      const DEFAULT_CONSEILLER = {
        nom: "Avi Bens",
        telephone: "07 56 97 85 17",
        email: "avi@snatchbot.me",
      };
      const COMPANY = {
        nom: "SOLAIRE FACILE",
        adresse: "9 Avenue du Pr√©sident Wilson",
        cp: "75016",
        ville: "Paris",
      };

      // üó∫Ô∏è Composant carte Mapbox interactive
      const MapboxMap = ({ lat, lng, zoom = 17, styleId = "satellite-streets-v12" }) => {
        const mapContainer = useRef(null);
        const map = useRef(null);
        const currentStyle = useRef(styleId);

        useEffect(() => {
          if (!lat || !lng || map.current) return;

          const loadMapbox = async () => {
            if (!window.mapboxgl) {
              const link = document.createElement("link");
              link.href = "https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css";
              link.rel = "stylesheet";
              document.head.appendChild(link);

              await new Promise((resolve) => {
                const script = document.createElement("script");
                script.src = "https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js";
                script.onload = resolve;
                document.head.appendChild(script);
              });
            }

            window.mapboxgl.accessToken = MAPBOX_TOKEN;

            map.current = new window.mapboxgl.Map({
              container: mapContainer.current,
              style: `mapbox://styles/mapbox/${styleId}`,
              center: [lng, lat],
              zoom: zoom,
              pitch: 45,
              bearing: 0,
            });

            new window.mapboxgl.Marker({ color: "#F97316" })
              .setLngLat([lng, lat])
              .addTo(map.current);

            map.current.addControl(new window.mapboxgl.NavigationControl());
            map.current.addControl(new window.mapboxgl.FullscreenControl());
            currentStyle.current = styleId;
          };

          loadMapbox();

          return () => {
            if (map.current) {
              map.current.remove();
              map.current = null;
            }
          };
        }, [lat, lng, zoom, styleId]);

        useEffect(() => {
          if (map.current && lat && lng) {
            map.current.flyTo({ center: [lng, lat], zoom: zoom, pitch: 45 });
          }
        }, [lat, lng, zoom]);

        useEffect(() => {
          if (map.current && currentStyle.current !== styleId) {
            map.current.setStyle(`mapbox://styles/mapbox/${styleId}`);
            currentStyle.current = styleId;
          }
        }, [styleId]);

        if (!lat || !lng) {
          return (
            <div className="flex items-center justify-center h-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-500">
              <div className="text-center">
                <div className="text-6xl mb-4">üìç</div>
                <p className="text-lg font-medium">S√©lectionnez une adresse</p>
                <p className="text-sm text-gray-400">dans l'onglet Informations</p>
              </div>
            </div>
          );
        }

        return <div ref={mapContainer} className="w-full h-full" />;
      };

      const getMapboxStaticUrl = (lat, lng, zoom = 18, width = 600, height = 400, styleId = "satellite-streets-v12") => {
        return `https://api.mapbox.com/styles/v1/mapbox/${styleId}/static/pin-l+f97316(${lng},${lat})/${lng},${lat},${zoom},0/${width}x${height}@2x?access_token=${MAPBOX_TOKEN}`;
      };

      const getMapbox3DStaticUrl = (
        lat,
        lng,
        zoom = 17,
        bearing = 0,
        pitch = 60,
        width = 600,
        height = 400,
        styleId = "satellite-streets-v12"
      ) => {
        return `https://api.mapbox.com/styles/v1/mapbox/${styleId}/static/${lng},${lat},${zoom},${bearing},${pitch}/${width}x${height}@2x?access_token=${MAPBOX_TOKEN}`;
      };

      function SolaireFacileGenerator() {
        const [tab, setTab] = useState(0);
        const [generating, setGenerating] = useState(false);
        const [suggestions, setSuggestions] = useState([]);
        const [showSugg, setShowSugg] = useState(false);
        const [pvgisLoading, setPvgisLoading] = useState(false);
        const [pvgis, setPvgis] = useState(null);
        const [logo, setLogo] = useState(null);
        const [mapStyle, setMapStyle] = useState("satellite-streets-v12");
        const fileRef = useRef(null);

        const [form, setForm] = useState({
          client: {
            civilite: "M.",
            nom: "",
            prenom: "",
            adresse: "",
            cp: "",
            ville: "",
            tel: "",
            email: "",
            type: "Maison individuelle",
            surface: "",
            annee: "",
            occupants: "",
            conso: "",
          },
          tech: {
            orientation: "Sud",
            inclinaison: 30,
            surfaceDispo: "",
            toiture: "Tuiles",
            ombrage: "Aucun",
            distCompteur: "",
            branchement: "Monophas√©",
            puissance: 6,
            coords: { lat: null, lng: null },
          },
          scenarios: { s1: { selected: true }, s2: { selected: false }, s3: { selected: false } },
          export: { financement: true, aides: true, simulation: true, contrat: false, validite: 30, notes: "" },
          conseiller: { ...DEFAULT_CONSEILLER },
        });

        const searchAddr = useCallback(async (q) => {
          if (q.length < 3) {
            setSuggestions([]);
            return;
          }
          try {
            const r = await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(q)}&limit=5`);
            const d = await r.json();
            setSuggestions(d.features || []);
            setShowSugg(true);
          } catch (e) {
            console.error(e);
          }
        }, []);

        const selectAddr = (f) => {
          const p = f.properties,
            c = f.geometry.coordinates;
          setForm((prev) => ({
            ...prev,
            client: { ...prev.client, adresse: p.name, cp: p.postcode, ville: p.city },
            tech: { ...prev.tech, coords: { lat: c[1], lng: c[0] } },
          }));
          setShowSugg(false);
          setSuggestions([]);
        };

        const fetchPVGIS = useCallback(async () => {
          const { lat, lng } = form.tech.coords;
          if (!lat) {
            alert("S√©lectionnez une adresse");
            return;
          }
          setPvgisLoading(true);
          try {
            const azMap = { Sud: 0, "Sud-Est": -45, "Sud-Ouest": 45, Est: -90, Ouest: 90 };
            const url = `https://re.jrc.ec.europa.eu/api/v5_2/PVcalc?lat=${lat}&lon=${lng}&peakpower=1&loss=14&angle=${form.tech.inclinaison}&aspect=${azMap[form.tech.orientation] || 0}&outputformat=json`;
            const r = await fetch(url);
            const d = await r.json();
            if (d.outputs)
              setPvgis({
                prod: d.outputs.totals.fixed.E_y,
                monthly: d.outputs.monthly.fixed,
                irrad: d.outputs.totals.fixed.H_y,
                pertes: d.outputs.totals.fixed.l_total,
              });
          } catch (e) {
            setPvgis({
              prod: 1150,
              monthly: [45, 65, 95, 115, 135, 145, 155, 140, 110, 80, 50, 35].map((v, i) => ({ month: i + 1, E_m: v })),
              irrad: 1350,
              pertes: 14,
            });
          }
          setPvgisLoading(false);
        }, [form.tech]);

        const handleLogo = useCallback((e) => {
          e.preventDefault();
          const f = e.dataTransfer?.files[0] || e.target?.files[0];
          if (f?.type.startsWith("image/")) {
            const r = new FileReader();
            r.onload = (ev) => setLogo(ev.target.result);
            r.readAsDataURL(f);
          }
        }, []);

        const calcFin = (kWc) => {
          const cout = kWc * 2200,
            prod = (pvgis?.prod || 1100) * kWc;
          const rev = prod * 0.35 * 0.22 + prod * 0.65 * 0.13;
          const prime = kWc <= 3 ? 370 * kWc : kWc <= 9 ? 280 * kWc : 200 * kWc;
          return { cout, apresAide: cout - prime, prod, rev, roi: cout / rev, prime, eco25: rev * 25, co2: prod * 0.05 };
        };

        const mapStyles = [
          { id: "satellite-streets-v12", name: "üõ∞Ô∏è Satellite", desc: "Vue satellite HD" },
          { id: "satellite-v9", name: "üõ∞Ô∏è Satellite Pure", desc: "Sans labels" },
          { id: "outdoors-v12", name: "üèîÔ∏è Terrain", desc: "Relief et contours" },
          { id: "streets-v12", name: "üó∫Ô∏è Plan", desc: "Carte classique" },
          { id: "light-v11", name: "‚¨ú Clair", desc: "Minimaliste clair" },
          { id: "dark-v11", name: "‚¨õ Sombre", desc: "Mode nuit" },
        ];

        const generatePDF = async () => {
          setGenerating(true);
          await new Promise((r) => setTimeout(r, 1000));
          const s1 = calcFin(3),
            s2 = calcFin(6),
            s3 = calcFin(9);
          const date = new Date().toLocaleDateString("fr-FR", { day: "numeric", month: "long", year: "numeric" });
          const vDate = new Date();
          vDate.setDate(vDate.getDate() + form.export.validite);
          const vDateStr = vDate.toLocaleDateString("fr-FR", { day: "numeric", month: "long", year: "numeric" });
          const addr = `${COMPANY.adresse}, ${COMPANY.cp} ${COMPANY.ville}`;

          const mapUrl = form.tech.coords.lat
            ? getMapboxStaticUrl(form.tech.coords.lat, form.tech.coords.lng, 18, 600, 350, mapStyle)
            : "";
          const map3DUrl = form.tech.coords.lat
            ? getMapbox3DStaticUrl(form.tech.coords.lat, form.tech.coords.lng, 17, 45, 60, 600, 350, mapStyle)
            : "";

          const hdr = `<div style="display:flex;justify-content:space-between;align-items:center;padding-bottom:15px;border-bottom:3px solid #F97316;margin-bottom:30px"><div style="display:flex;align-items:center;gap:15px"><div style="width:50px;height:50px;background:linear-gradient(135deg,#F97316,#F59E0B);border-radius:12px;display:flex;align-items:center;justify-content:center;color:white;font-size:24px">‚òÄ</div><div style="font-size:24px;font-weight:800;color:#F97316">SOLAIRE FACILE</div></div></div>`;
          const ftr = (n) => `<div style="position:absolute;bottom:15mm;left:20mm;right:20mm;display:flex;justify-content:space-between;padding-top:15px;border-top:1px solid #E5E7EB;font-size:10px;color:#9CA3AF"><span>SOLAIRE FACILE - ${addr}</span><span>Page ${n}/33</span></div>`;
          const pg = (n, c) => `<div style="width:210mm;min-height:297mm;padding:20mm;margin:0 auto;background:white;page-break-after:always;position:relative;font-family:'Segoe UI',sans-serif">${c}${ftr(n)}</div>`;
          const title = (t) => `<h1 style="font-size:28px;font-weight:800;color:#1E3A5F;margin-bottom:25px;padding-bottom:10px;border-bottom:3px solid #F97316">${t}</h1>`;
          const card = (l, v) => `<div style="background:#F9FAFB;padding:20px;border-radius:12px;border-left:4px solid #F97316"><div style="font-size:12px;color:#6B7280;text-transform:uppercase;margin-bottom:5px">${l}</div><div style="font-size:18px;font-weight:600">${v}</div></div>`;
          const grid = (items) => `<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-bottom:30px">${items.map((i) => card(i[0], i[1])).join("")}</div>`;
          const tbl = (rows, hdrs) => `<table style="width:100%;border-collapse:collapse;margin:20px 0"><tr>${hdrs.map((h) => `<th style="background:linear-gradient(135deg,#F97316,#F59E0B);color:white;padding:12px 15px;text-align:left">${h}</th>`).join("")}</tr>${rows
            .map((r, i) => `<tr style="background:${i % 2 ? "#F9FAFB" : "white"}">${r
              .map((c) => `<td style=\"padding:12px 15px;border-bottom:1px solid #E5E7EB\">${c}</td>`)
              .join("")}</tr>`)
            .join("")}</table>`;
          const box = (t, c) => `<div style="background:linear-gradient(135deg,#FFF7ED,#FEF3C7);padding:25px;border-radius:16px;margin:25px 0;border:2px solid #F97316"><div style="font-weight:700;color:#1E3A5F;margin-bottom:10px">${t}</div><p style="color:#4B5563">${c}</p></div>`;
          const scenCard = (name, kWc, pan, color, fin) => `<div style="background:white;border-radius:16px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.1);margin-bottom:30px"><div style="padding:20px;color:white;background:linear-gradient(135deg,${color})"><div style="font-size:24px;font-weight:700">${name}</div><div style="opacity:0.9">${pan} panneaux ‚Ä¢ ${kWc} kWc</div></div><div style="padding:25px">${[
            ["Production annuelle", `${fin.prod.toLocaleString("fr-FR")} kWh`],
            ["Co√ªt installation", `${fin.cout.toLocaleString("fr-FR")} ‚Ç¨`],
            ["Prime", `<span style=\"color:#10B981\">- ${fin.prime.toLocaleString("fr-FR")} ‚Ç¨</span>`],
            ["Co√ªt apr√®s aides", `<span style=\"color:#F97316;font-size:20px;font-weight:700\">${fin.apresAide.toLocaleString("fr-FR")} ‚Ç¨</span>`],
            ["√âconomies/an", `<span style=\"color:#10B981\">+ ${fin.rev.toFixed(0)} ‚Ç¨</span>`],
            ["ROI", `${fin.roi.toFixed(1)} ans`],
          ]
            .map(
              (r) =>
                `<div style=\"display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #E5E7EB\"><span style=\"color:#6B7280\">${r[0]}</span><span style=\"font-weight:600\">${r[1]}</span></div>`
            )
            .join("")}</div></div>`;
          const ecoBox = (fin, color) => `<div style="background:linear-gradient(135deg,${color});color:white;padding:25px;border-radius:16px;display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:14px;opacity:0.9">√âconomie 25 ans</div><div style="font-size:32px;font-weight:800">${fin.eco25.toLocaleString("fr-FR")} ‚Ç¨</div></div><div style="text-align:right"><div style="font-size:14px;opacity:0.9">CO‚ÇÇ √©vit√©/an</div><div style="font-size:24px;font-weight:700">${(fin.co2 / 1000).toFixed(1)} t</div></div></div>`;

          const pages = [
            `<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;min-height:257mm"><div style="display:flex;align-items:center;gap:15px;margin-bottom:40px"><div style="width:60px;height:60px;background:linear-gradient(135deg,#F97316,#F59E0B);border-radius:16px;display:flex;align-items:center;justify-content:center;color:white;font-size:32px">‚òÄ</div><div><div style="font-size:32px;font-weight:800;color:#F97316">SOLAIRE FACILE</div><div style="font-size:12px;color:#6B7280">L'√©nergie solaire accessible √† tous</div></div></div><h1 style="font-size:42px;font-weight:900;color:#1E3A5F;margin-bottom:20px">PR√â-√âTUDE SOLAIRE</h1><p style="font-size:24px;color:#F97316;font-weight:600;margin-bottom:40px">Votre projet photovolta√Øque personnalis√©</p><div style="background:linear-gradient(135deg,#FFF7ED,#FEF3C7);padding:30px 50px;border-radius:20px;margin-bottom:40px"><div style="font-size:28px;font-weight:700">${form.client.civilite} ${form.client.prenom} ${form.client.nom}</div><div style="font-size:16px;color:#6B7280;margin-top:10px">${form.client.adresse}<br>${form.client.cp} ${form.client.ville}</div></div><div style="font-size:14px;color:#9CA3AF">Document g√©n√©r√© le ${date}<br>Valide jusqu'au ${vDateStr}</div></div>`,
            `${hdr}${title("Sommaire")}${[
              ["1. Pr√©sentation Solaire Facile", "3-4"],
              ["2. Pourquoi passer au solaire ?", "5-6"],
              ["3. Votre fiche client", "7-8"],
              ["4. Analyse technique", "9-10"],
              ["5. Vue satellite et implantation", "11-12"],
              ["6. Donn√©es PVGIS", "13-15"],
              ["7. Sc√©nario Essentiel - 3 kWc", "16-18"],
              ["8. Sc√©nario Confort - 6 kWc", "19-21"],
              ["9. Sc√©nario Premium - 9 kWc", "22-24"],
              ["10. Comparatif des sc√©narios", "25-26"],
              ["11. Aides et subventions", "27-28"],
              ["12. Options de financement", "29-30"],
              ["13. Garanties et SAV", "31"],
              ["14. Prochaines √©tapes", "32"],
              ["15. Votre conseiller", "33"],
            ]
              .map(
                (i) =>
                  `<div style=\"display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px dotted #D1D5DB\"><span>${i[0]}</span><span style=\"color:#F97316;font-weight:600\">${i[1]}</span></div>`
              )
              .join("")}`,
            `${hdr}${title("Pr√©sentation Solaire Facile")}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Notre Mission</h2><p style="color:#4B5563;margin-bottom:20px">Solaire Facile accompagne les particuliers et professionnels dans leur transition √©nerg√©tique depuis plus de 10 ans.</p>${grid([
              ["Installations", "+5 000"],
              ["Satisfaction", "98%"],
              ["Exp√©rience", "12 ans"],
              ["√âquipe", "45 experts"],
            ])}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Nos Valeurs</h2><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px">${[
              ["üå±", "√âcologie", "#10B981,#14B8A6"],
              ["ü§ù", "Confiance", "#F97316,#F59E0B"],
              ["‚ö°", "Excellence", "#3B82F6,#6366F1"],
            ]
              .map(
                (v) =>
                  `<div style=\"background:linear-gradient(135deg,${v[2]});color:white;padding:20px;border-radius:12px;text-align:center\"><div style=\"font-size:30px\">${v[0]}</div><div style=\"font-weight:600\">${v[1]}</div></div>`
              )
              .join("")}</div>`,
            `${hdr}${title("Certifications & Partenaires")}${grid([
              ["Certification", "QualiPV RGE"],
              ["Certification", "Qualibat"],
              ["Assurance", "D√©cennale AXA"],
              ["Agr√©ment", "CONSUEL"],
            ])}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Partenaires Fabricants</h2>${tbl(
              [
                ["Panneaux", "SunPower / Longi", "25 ans"],
                ["Onduleurs", "Enphase / SolarEdge", "25 ans"],
                ["Batteries", "Tesla / BYD", "10 ans"],
              ],
              ["√âquipement", "Marque", "Garantie"]
            )}`,
            `${hdr}${title("Pourquoi passer au solaire ?")}${box(
              "üìà Hausse des prix",
              "Le prix du kWh a augment√© de +108% entre 2020 et 2024."
            )}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Les avantages</h2>${grid([
              ["üí∞ √âconomies", "Jusqu'√† -70%"],
              ["üè† Valorisation", "+5 √† 10%"],
              ["üîí Ind√©pendance", "Protection tarifaire"],
              ["üåç √âcologie", "Empreinte r√©duite"],
            ])}`,
            `${hdr}${title("L'autoconsommation")}<p style="color:#4B5563;margin-bottom:20px">Consommez directement votre production. Le surplus est revendu √† EDF OA.</p><div style="background:#1E3A5F;color:white;padding:25px;border-radius:16px;margin-bottom:25px"><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;text-align:center">${[
              ["35%", "Autoconsommation"],
              ["65%", "Revente"],
              ["20 ans", "Contrat garanti"],
            ]
              .map(
                (i) =>
                  `<div><div style=\"font-size:36px;font-weight:800\">${i[0]}</div><div style=\"font-size:12px;opacity:0.8\">${i[1]}</div></div>`
              )
              .join("")}</div></div>${tbl(
              [
                ["‚â§ 3 kWc", "0.1297 ‚Ç¨/kWh", "0.1657 ‚Ç¨/kWh"],
                ["‚â§ 9 kWc", "0.1297 ‚Ç¨/kWh", "0.1409 ‚Ç¨/kWh"],
              ],
              ["Puissance", "Autoconso", "Vente totale"]
            )}`,
            `${hdr}${title("Votre Fiche Client")}${grid([
              ["Nom", `${form.client.civilite} ${form.client.prenom} ${form.client.nom}`],
              ["T√©l√©phone", form.client.tel || "-"],
              ["Email", form.client.email || "-"],
              ["Date √©tude", date],
            ])}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Adresse</h2><div style="background:linear-gradient(135deg,#FFF7ED,#FEF3C7);padding:25px;border-radius:16px;border:2px solid #F97316"><div style="font-size:18px;font-weight:600">${form.client.adresse}<br>${form.client.cp} ${form.client.ville}</div>${
              form.tech.coords.lat
                ? `<div style=\"margin-top:10px;font-size:13px;color:#6B7280\">GPS: ${form.tech.coords.lat.toFixed(5)}, ${form.tech.coords.lng.toFixed(5)}</div>`
                : ""
            }</div>`,
            `${hdr}${title("Votre Consommation")}<div style="background:linear-gradient(135deg,#EFF6FF,#DBEAFE);padding:25px;border-radius:16px;border:2px solid #3B82F6;margin-bottom:25px"><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:12px;color:#6B7280">Consommation annuelle</div><div style="font-size:36px;font-weight:800;color:#1E40AF">${
              form.client.conso || "8 500"
            } kWh</div></div><div style="text-align:right"><div style="font-size:12px;color:#6B7280">Co√ªt actuel</div><div style="font-size:24px;font-weight:700;color:#DC2626">${(
              (form.client.conso || 8500) * 0.22
            ).toLocaleString("fr-FR")} ‚Ç¨/an</div></div></div></div>${grid([
              ["Type", form.client.type],
              ["Surface", `${form.client.surface || "-"} m¬≤`],
              ["Construction", form.client.annee || "-"],
              ["Occupants", form.client.occupants || "-"],
            ])}`,
            `${hdr}${title("Analyse Technique")}${grid([
              ["Orientation", form.tech.orientation],
              ["Inclinaison", `${form.tech.inclinaison}¬∞`],
              ["Toiture", form.tech.toiture],
              ["Surface dispo", `${form.tech.surfaceDispo || "40"} m¬≤`],
              ["Ombrage", form.tech.ombrage],
              ["Performance", form.tech.orientation === "Sud" ? "97%" : "92%"],
            ])}`,
            `${hdr}${title("Raccordement √âlectrique")}${grid([
              ["Branchement", form.tech.branchement],
              ["Puissance compteur", `${form.tech.puissance} kVA`],
              ["Distance compteur", `${form.tech.distCompteur || "15"} m`],
              ["Max injectable", form.tech.branchement === "Monophas√©" ? "6 kVA" : "9 kVA"],
            ])}${box(
              "üìã D√©marches incluses",
              "D√©claration mairie ‚Ä¢ Raccordement Enedis ‚Ä¢ Contrat EDF OA ‚Ä¢ CONSUEL ‚Ä¢ Dossier prime"
            )}`,
            `${hdr}${title("Vue Satellite")}<div style="background:#F3F4F6;height:350px;border-radius:16px;display:flex;align-items:center;justify-content:center;margin-bottom:25px;overflow:hidden">${
              mapUrl
                ? `<img src=\"${mapUrl}\" style=\"width:100%;height:100%;object-fit:cover\"/>`
                : `<div style=\"text-align:center;color:#9CA3AF\"><div style=\"font-size:48px\">üó∫Ô∏è</div><div>Vue satellite Mapbox</div></div>`
            }</div>${grid([
              ["Adresse", `${form.client.adresse}, ${form.client.cp}`],
              ["GPS", form.tech.coords.lat ? `${form.tech.coords.lat.toFixed(5)}, ${form.tech.coords.lng.toFixed(5)}` : "-"],
            ])}`,
            `${hdr}${title("Implantation Pr√©visionnelle")}<div style="background:#F3F4F6;height:280px;border-radius:16px;overflow:hidden;margin-bottom:20px">${
              map3DUrl
                ? `<img src=\"${map3DUrl}\" style=\"width:100%;height:100%;object-fit:cover\"/>`
                : `<div style=\"display:flex;align-items:center;justify-content:center;height:100%;color:#9CA3AF\"><div style=\"text-align:center\"><div style=\"font-size:48px\">üè†</div><div>Vue 3D</div></div></div>`
            }</div><p style="color:#4B5563;margin-bottom:15px">Capacit√© selon ${form.tech.surfaceDispo || 40} m¬≤ disponibles</p>${tbl(
              [
                ["Essentiel", "8", "3 kWc", "~16 m¬≤"],
                ["Confort ‚≠ê", "16", "6 kWc", "~32 m¬≤"],
                ["Premium", "24", "9 kWc", "~48 m¬≤"],
              ],
              ["Sc√©nario", "Panneaux", "Puissance", "Surface"]
            )}<div style="background:#F0FDF4;padding:15px;border-radius:12px;border-left:4px solid #10B981;margin-top:15px"><div style="font-weight:600;color:#166534">‚úì Capacit√© max: ${
              Math.floor((form.tech.surfaceDispo || 40) / 2)
            } panneaux (${(Math.floor((form.tech.surfaceDispo || 40) / 2) * 0.375).toFixed(1)} kWc)</div></div>`,
            `${hdr}${title("Donn√©es PVGIS")}<p style="color:#4B5563;margin-bottom:20px">Donn√©es Commission Europ√©enne - r√©f√©rence mondiale</p><div style="background:linear-gradient(135deg,#1E3A5F,#2D4A6F);color:white;padding:30px;border-radius:16px;margin-bottom:25px"><div style="display:grid;grid-template-columns:repeat(2,1fr);gap:25px;text-align:center"><div><div style="font-size:14px;opacity:0.8">Production/an</div><div style="font-size:42px;font-weight:800">${pvgis?.prod?.toFixed(0) || "1150"}</div><div style="font-size:14px;opacity:0.8">kWh/kWc</div></div><div><div style="font-size:14px;opacity:0.8">Irradiation</div><div style="font-size:42px;font-weight:800">${pvgis?.irrad?.toFixed(0) || "1350"}</div><div style="font-size:14px;opacity:0.8">kWh/m¬≤</div></div></div></div>${grid([
              ["Latitude", form.tech.coords.lat ? form.tech.coords.lat.toFixed(4) + "¬∞" : "-"],
              ["Longitude", form.tech.coords.lng ? form.tech.coords.lng.toFixed(4) + "¬∞" : "-"],
            ])}`,
            `${hdr}${title("Production Mensuelle")}${tbl(
              [
                ["Janvier", "45", "‚≠ê"],
                ["F√©vrier", "65", "‚≠ê‚≠ê"],
                ["Mars", "95", "‚≠ê‚≠ê‚≠ê"],
                ["Avril", "115", "‚≠ê‚≠ê‚≠ê‚≠ê"],
                ["Mai", "135", "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"],
                ["Juin", "145", "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"],
                ["Juillet", "155", "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"],
                ["Ao√ªt", "140", "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"],
                ["Septembre", "110", "‚≠ê‚≠ê‚≠ê‚≠ê"],
                ["Octobre", "80", "‚≠ê‚≠ê‚≠ê"],
                ["Novembre", "50", "‚≠ê‚≠ê"],
                ["D√©cembre", "35", "‚≠ê"],
              ],
              ["Mois", "kWh/kWc", "Niveau"]
            )}`,
            `${hdr}${title("Synth√®se Production")}${tbl(
              [
                ["Essentiel", "3 kWc", `${s1.prod.toLocaleString("fr-FR")} kWh`, "~0.4"],
                ["Confort ‚≠ê", "6 kWc", `${s2.prod.toLocaleString("fr-FR")} kWh`, "~0.8"],
                ["Premium", "9 kWc", `${s3.prod.toLocaleString("fr-FR")} kWh`, "~1.2"],
              ],
              ["Sc√©nario", "Puissance", "Production", "√âquiv. foyers"]
            )}${box(
              "üí° Le saviez-vous ?",
              "Un foyer consomme ~8500 kWh/an. Avec 6 kWc, vous produisez 80% de cette consommation !"
            )}`,
            `${hdr}${title("Sc√©nario Essentiel - 3 kWc")}${scenCard("Installation Essentiel", 3, 8, "#10B981,#14B8A6", s1)}${ecoBox(
              s1,
              "#10B981,#14B8A6"
            )}`,
            `${hdr}${title("Essentiel - √âquipements")}${tbl(
              [
                ["Panneaux", "JA Solar 375Wc", "8", "25 ans"],
                ["Micro-onduleurs", "Enphase IQ7+", "8", "25 ans"],
                ["Fixation", "K2 Systems", "1 kit", "20 ans"],
                ["Coffret AC", "Protection", "1", "10 ans"],
                ["Monitoring", "Enphase Envoy", "1", "5 ans"],
              ],
              ["√âquipement", "Mod√®le", "Qt√©", "Garantie"]
            )}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Prestations incluses</h2><ul style="color:#4B5563;margin-left:20px;line-height:2"><li>√âtude technique</li><li>D√©marches administratives</li><li>Installation RGE</li><li>Mise en service</li><li>Formation</li></ul>`,
            `${hdr}${title("Essentiel - Planning")}${[
              "Signature (J)",
              "Visite technique (J+7)",
              "D√©claration mairie (J+14)",
              "Autorisation (J+45)",
              "Installation (J+60)",
              "Raccordement (J+90)",
              "Production ! (J+90)",
            ]
              .map(
                (s, i) =>
                  `<div style=\"display:flex;gap:20px;margin-bottom:15px\"><div style=\"width:30px;height:30px;background:#10B981;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold\">${
                    i + 1
                  }</div><div style=\"flex:1;background:#F9FAFB;padding:15px;border-radius:12px;border-left:4px solid #10B981\">${s}</div></div>`
              )
              .join("")}<div style="background:#EFF6FF;padding:20px;border-radius:12px;border:2px solid #3B82F6;margin-top:20px"><div style="font-weight:700;color:#1E40AF">‚è±Ô∏è D√©lai: ~3 mois</div></div>`,
            `${hdr}${title("Sc√©nario Confort - 6 kWc ‚≠ê RECOMMAND√â")}${scenCard("Installation Confort", 6, 16, "#F97316,#F59E0B", s2)}${ecoBox(
              s2,
              "#F97316,#F59E0B"
            )}`,
            `${hdr}${title("Confort - √âquipements")}${tbl(
              [
                ["Panneaux", "Longi Hi-MO 5 375Wc", "16", "25 ans"],
                ["Micro-onduleurs", "Enphase IQ7+", "16", "25 ans"],
                ["Fixation", "K2 Systems", "1 kit", "20 ans"],
                ["Coffret AC", "Renforc√©", "1", "10 ans"],
                ["Monitoring", "Enphase Envoy-S", "1", "5 ans"],
              ],
              ["√âquipement", "Mod√®le", "Qt√©", "Garantie"]
            )}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Avantages</h2><div style="display:grid;grid-template-columns:repeat(2,1fr);gap:15px">${[
              "Meilleur rapport qualit√©/prix",
              "Couverture ~80% besoins",
              "ROI optimal",
              "√âvolutif (batterie)",
            ]
              .map((a) => `<div style=\"background:#FFF7ED;padding:15px;border-radius:12px\"><div style=\"font-weight:600;color:#C2410C\">‚úì ${a}</div></div>`)
              .join("")}</div>`,
            `${hdr}${title("Confort - Financement")}${grid([
              ["Comptant", `${s2.apresAide.toLocaleString("fr-FR")} ‚Ç¨`],
              ["Cr√©dit 120 mois", `${Math.round((s2.apresAide * 1.08) / 120)} ‚Ç¨/mois`],
              ["Cr√©dit 180 mois", `${Math.round((s2.apresAide * 1.12) / 180)} ‚Ç¨/mois`],
              ["√âconomie/mois", `${Math.round(s2.rev / 12)} ‚Ç¨`],
            ])}${box(
              "üí° Autofinancement possible !",
              `Cr√©dit ${Math.round((s2.apresAide * 1.12) / 180)} ‚Ç¨/mois vs √©conomies ${Math.round(s2.rev / 12)} ‚Ç¨/mois = quasi-neutre !`
            )}`,
            `${hdr}${title("Sc√©nario Premium - 9 kWc")}${scenCard("Installation Premium", 9, 24, "#8B5CF6,#6366F1", s3)}${ecoBox(
              s3,
              "#8B5CF6,#6366F1"
            )}`,
            `${hdr}${title("Premium - √âquipements")}${tbl(
              [
                ["Panneaux", "SunPower Maxeon 3 400Wc", "24", "25 ans"],
                ["Micro-onduleurs", "Enphase IQ8+", "24", "25 ans"],
                ["Fixation", "K2 Systems Premium", "1 kit", "20 ans"],
                ["Coffret AC", "Triphas√©", "1", "10 ans"],
                ["Monitoring", "Envoy-S Metered", "1", "5 ans"],
              ],
              ["√âquipement", "Mod√®le", "Qt√©", "Garantie"]
            )}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Id√©al pour</h2><div style="display:grid;grid-template-columns:repeat(2,1fr);gap:15px">${[
              "Grandes maisons",
              "V√©hicule √©lectrique",
              "Piscine chauff√©e",
              "Climatisation",
            ]
              .map((a) => `<div style=\"background:#F3E8FF;padding:15px;border-radius:12px\"><div style=\"font-weight:600;color:#7C3AED\">‚úì ${a}</div></div>`)
              .join("")}</div>`,
            `${hdr}${title("Premium - Options")}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Batterie de stockage</h2><div style="background:white;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.1);padding:25px;margin-bottom:25px">${[
              ["Tesla Powerwall 2", "13.5 kWh"],
              ["Co√ªt", "+8 500 ‚Ç¨"],
              ["Autoconsommation", "Jusqu'√† 80%"],
            ]
              .map(
                (r) =>
                  `<div style=\"display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #E5E7EB\"><span style=\"color:#6B7280\">${r[0]}</span><span style=\"font-weight:600\">${r[1]}</span></div>`
              )
              .join("")}</div><h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Borne de recharge VE</h2><div style="background:white;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.1);padding:25px">${[
              ["Wallbox Pulsar Plus", "22 kW"],
              ["Co√ªt", "+1 500 ‚Ç¨"],
              ["Cr√©dit imp√¥t", "-300 ‚Ç¨"],
            ]
              .map(
                (r) =>
                  `<div style=\"display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #E5E7EB\"><span style=\"color:#6B7280\">${r[0]}</span><span style=\"font-weight:600\">${r[1]}</span></div>`
              )
              .join("")}</div>`,
            `${hdr}${title("Comparatif des Sc√©narios")}<table style="width:100%;border-collapse:collapse;margin:20px 0"><tr><th style="background:#374151;color:white;padding:12px">Crit√®re</th><th style="background:linear-gradient(135deg,#10B981,#14B8A6);color:white;padding:12px">Essentiel</th><th style="background:linear-gradient(135deg,#F97316,#F59E0B);color:white;padding:12px">Confort ‚≠ê</th><th style="background:linear-gradient(135deg,#8B5CF6,#6366F1);color:white;padding:12px">Premium</th></tr>${[
              ["Puissance", "3 kWc", "6 kWc", "9 kWc"],
              ["Production", s1.prod.toLocaleString("fr-FR"), s2.prod.toLocaleString("fr-FR"), s3.prod.toLocaleString("fr-FR")],
              ["Co√ªt apr√®s aides", `${s1.apresAide.toLocaleString("fr-FR")} ‚Ç¨`, `${s2.apresAide.toLocaleString("fr-FR")} ‚Ç¨`, `${s3.apresAide.toLocaleString("fr-FR")} ‚Ç¨`],
              ["√âconomie/an", `${s1.rev.toFixed(0)} ‚Ç¨`, `${s2.rev.toFixed(0)} ‚Ç¨`, `${s3.rev.toFixed(0)} ‚Ç¨`],
              ["ROI", `${s1.roi.toFixed(1)} ans`, `${s2.roi.toFixed(1)} ans`, `${s3.roi.toFixed(1)} ans`],
              ["√âconomie 25 ans", `${s1.eco25.toLocaleString("fr-FR")} ‚Ç¨`, `${s2.eco25.toLocaleString("fr-FR")} ‚Ç¨`, `${s3.eco25.toLocaleString("fr-FR")} ‚Ç¨`],
            ]
              .map(
                (r, i) =>
                  `<tr style=\"background:${i % 2 ? "#F9FAFB" : "white"}\"><td style=\"padding:12px;border-bottom:1px solid #E5E7EB;font-weight:600\">${r[0]}</td><td style=\"padding:12px;border-bottom:1px solid #E5E7EB;text-align:center\">${r[1]}</td><td style=\"padding:12px;border-bottom:1px solid #E5E7EB;text-align:center;font-weight:700\">${r[2]}</td><td style=\"padding:12px;border-bottom:1px solid #E5E7EB;text-align:center\">${r[3]}</td></tr>`
              )
              .join("")}</table>${box(
              "üèÜ Recommandation: Confort",
              `Meilleur √©quilibre investissement/rentabilit√©. ROI optimal de ${s2.roi.toFixed(1)} ans.`
            )}`,
            `${hdr}${title("Projection 25 ans")}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Cumul des √©conomies</h2><div style="background:#F9FAFB;padding:30px;border-radius:16px;display:flex;justify-content:space-around;align-items:flex-end;height:220px;margin-bottom:30px">${[
              [s1, "#10B981", "Essentiel"],
              [s2, "#F97316", "Confort ‚≠ê"],
              [s3, "#8B5CF6", "Premium"],
            ]
              .map(
                ([f, c, n]) =>
                  `<div style=\"text-align:center\"><div style=\"background:${c};width:80px;height:${Math.round((f.eco25 / s3.eco25) * 150)}px;border-radius:8px 8px 0 0;margin:0 auto\"></div><div style=\"margin-top:10px;font-weight:600\">${f.eco25.toLocaleString("fr-FR")} ‚Ç¨</div><div style=\"font-size:12px;color:#6B7280\">${n}</div></div>`
              )
              .join("")}</div>${grid([
              ["CO‚ÇÇ √©vit√© Confort", `${((s2.co2 * 25) / 1000).toFixed(0)} tonnes`],
              ["√âquiv. arbres", `~${Math.round((s2.co2 * 25) / 20)} üå≥`],
            ])}`,
            `${hdr}${title("Aides et Subventions")}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Prime autoconsommation 2024</h2>${tbl(
              [
                ["‚â§ 3 kWc", "370 ‚Ç¨/kWc", "1 110 ‚Ç¨"],
                ["‚â§ 9 kWc", "280 ‚Ç¨/kWc", "1 680 - 2 520 ‚Ç¨"],
                ["‚â§ 36 kWc", "200 ‚Ç¨/kWc", "Variable"],
              ],
              ["Puissance", "Prime/kWc", "Total"]
            )}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">TVA r√©duite</h2>${grid([
              ["‚â§ 3 kWc", "TVA 10%"],
              [">3 kWc", "TVA 20%"],
            ])}${box(
              "‚úì Revenus exon√©r√©s d'imp√¥t",
              "Pour installations ‚â§ 3 kWc raccord√©es en 2 points max."
            )}`,
            `${hdr}${title("Aides Locales")}${tbl(
              [
                ["Aide r√©gionale", "Conseil R√©gional", "Variable", "√Ä v√©rifier"],
                ["Aide d√©partementale", "D√©partement", "Variable", "√Ä v√©rifier"],
                ["CEE", "Fournisseurs", "200-500 ‚Ç¨", "Disponible"],
              ],
              ["Type", "Organisme", "Montant", "Statut"]
            )}${box(
              "üìã Notre engagement",
              "Nous constituons tous les dossiers de demande d'aides. Service inclus."
            )}<div style="background:linear-gradient(135deg,#F97316,#F59E0B);color:white;padding:25px;border-radius:16px;display:flex;justify-content:space-between;align-items:center;margin-top:25px"><div><div style="font-size:14px;opacity:0.9">Total aides estim√©es</div><div style="font-size:36px;font-weight:800">${s2.prime.toLocaleString("fr-FR")} ‚Ç¨</div></div><div style="text-align:right"><div style="font-size:14px;opacity:0.9">R√©duction</div><div style="font-size:24px;font-weight:700">${Math.round((s2.prime / s2.cout) * 100)}%</div></div></div>`,
            `${hdr}${title("Options de Financement")}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">1. Paiement comptant</h2><div style="background:white;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.1);padding:25px;margin-bottom:25px">${[
              ["Avantage", "Meilleure rentabilit√©"],
              ["Frais financiers", "Aucun"],
              ["ROI Confort", `${s2.roi.toFixed(1)} ans`],
            ]
              .map(
                (r) =>
                  `<div style=\"display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #E5E7EB\"><span style=\"color:#6B7280\">${r[0]}</span><span style=\"font-weight:600;color:#10B981\">${r[1]}</span></div>`
              )
              .join("")}</div><h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">2. Cr√©dit solaire</h2>${grid([
              ["60 mois", `${Math.round((s2.apresAide * 1.05) / 60)} ‚Ç¨/mois`],
              ["120 mois", `${Math.round((s2.apresAide * 1.08) / 120)} ‚Ç¨/mois`],
              ["180 mois", `${Math.round((s2.apresAide * 1.12) / 180)} ‚Ç¨/mois`],
              ["240 mois", `${Math.round((s2.apresAide * 1.18) / 240)} ‚Ç¨/mois`],
            ])}`,
            `${hdr}${title("Simulation Financement")}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Sc√©nario Confort - Cr√©dit 180 mois</h2><div style="background:#1E3A5F;color:white;padding:30px;border-radius:16px;margin-bottom:25px"><div style="display:grid;grid-template-columns:repeat(2,1fr);gap:20px;text-align:center"><div><div style="font-size:14px;opacity:0.8">Mensualit√© cr√©dit</div><div style="font-size:32px;font-weight:800">${Math.round((s2.apresAide * 1.12) / 180)} ‚Ç¨</div></div><div><div style="font-size:14px;opacity:0.8">√âconomie mensuelle</div><div style="font-size:32px;font-weight:800;color:#10B981">${Math.round(s2.rev / 12)} ‚Ç¨</div></div></div></div>${box(
              `‚úì Diff√©rence: ${Math.round(s2.rev / 12) - Math.round((s2.apresAide * 1.12) / 180) > 0 ? "+" : ""}${
                Math.round(s2.rev / 12) - Math.round((s2.apresAide * 1.12) / 180)
              } ‚Ç¨/mois`,
              "Votre installation peut s'autofinancer gr√¢ce aux √©conomies g√©n√©r√©es."
            )}`,
            `${hdr}${title("Garanties et SAV")}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Garanties mat√©riel</h2>${tbl(
              [
                ["Panneaux solaires", "25 ans", "30 ans (80% min)"],
                ["Micro-onduleurs", "25 ans", "-"],
                ["Structure/Fixation", "20 ans", "-"],
                ["C√¢blage/Coffret", "10 ans", "-"],
              ],
              ["√âquipement", "Garantie produit", "Garantie perf."]
            )}<h2 style="font-size:20px;font-weight:700;color:#374151;margin:20px 0 15px">Garanties installation</h2>${grid([
              ["D√©cennale", "10 ans - AXA"],
              ["Main d'≈ìuvre", "2 ans"],
              ["Production", "1 an garanti"],
              ["SAV", "Hotline 7j/7"],
            ])}${box(
              "üõ°Ô∏è Assurance production",
              "En option: remboursement de l'√©lectricit√© non produite en cas de panne."
            )}`,
            `${hdr}${title("Les Prochaines √âtapes")}${[
              ["1", "Validation du devis", "Signature √©lectronique rapide", "#F97316"],
              ["2", "Visite technique", "Validation faisabilit√© sous 7 jours", "#F97316"],
              ["3", "D√©marches admin", "Mairie, Enedis, EDF OA, CONSUEL", "#F97316"],
              ["4", "Installation", "Pose par √©quipes RGE, 1-2 jours", "#F97316"],
              ["5", "Production !", "Mise en service, vous √©conomisez !", "#10B981"],
            ]
              .map(
                (s) =>
                  `<div style=\"display:flex;gap:20px;margin-bottom:20px\"><div style=\"width:50px;height:50px;background:${s[3]};border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:20px;font-weight:bold;flex-shrink:0\">${s[0]}</div><div style=\"flex:1\"><div style=\"font-size:18px;font-weight:700;color:#1E3A5F;margin-bottom:5px\">${s[1]}</div><p style=\"color:#4B5563\">${s[2]}</p></div></div>`
              )
              .join("")}${box(
              "üí¨ √Ä retenir",
              "D√©lais moyens 3 mois. Nous g√©rons toutes les d√©marches et suivons la production."
            )}`,
            `${hdr}${title("Votre Conseiller")}${grid([
              ["Nom", form.conseiller.nom],
              ["T√©l√©phone", form.conseiller.telephone],
              ["Email", form.conseiller.email],
            ])}<div style="background:linear-gradient(135deg,#F97316,#F59E0B);padding:25px;border-radius:16px;color:white;margin-top:25px;display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:18px;font-weight:700">${form.conseiller.nom}</div><div style="opacity:0.9">Conseiller √ânergie Solaire</div><div style="font-size:18px;margin:15px 0">üìû ${form.conseiller.telephone}</div><div style="font-size:18px;margin:15px 0">‚úâÔ∏è ${form.conseiller.email}</div></div><div style="background:linear-gradient(135deg,#FFF7ED,#FEF3C7);padding:25px;border-radius:16px;border:2px solid #F97316;text-align:center"><div style="font-weight:700;color:#1E3A5F;font-size:20px;margin-bottom:15px">Pr√™t √† passer au solaire ?</div><p style="color:#4B5563;margin-bottom:20px">Disponible du lundi au samedi, 9h-19h</p><div style="background:linear-gradient(135deg,#F97316,#F59E0B);color:white;padding:15px 30px;border-radius:12px;display:inline-block;font-weight:700;font-size:18px">Appelez: ${form.conseiller.telephone}</div></div><div style="margin-top:40px;text-align:center"><div style="display:flex;align-items:center;justify-content:center;gap:15px;margin-bottom:15px"><div style="width:40px;height:40px;background:linear-gradient(135deg,#F97316,#F59E0B);border-radius:10px;display:flex;align-items:center;justify-content:center;color:white;font-size:20px">‚òÄ</div><div style="font-size:20px;font-weight:800;color:#F97316">SOLAIRE FACILE</div></div><div style="color:#6B7280;font-size:12px">${addr}</div></div>`
          ];

          const html = `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>Pr√©-√âtude Solaire - ${form.client.nom}</title><style>@import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700;800&display=swap');*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',sans-serif;color:#1F2937;line-height:1.6}@media print{div[style*="page-break"]{page-break-after:always}body{-webkit-print-color-adjust:exact;print-color-adjust:exact}}</style></head><body>${pages
            .map((c, i) => pg(i + 1, c))
            .join("")}</body></html>`;

          const blob = new Blob([html], { type: "text/html" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `PreEtude_Solaire_${form.client.nom || "Client"}.html`;
          a.click();
          URL.revokeObjectURL(url);
          setGenerating(false);
        };

        const tabs = ["Informations", "Technique", "Sc√©narios", "Export", "Structure PDF"];

        return (
          <div className="min-h-screen bg-gradient-to-br from-orange-50 via-amber-50 to-yellow-50">
            <header className="bg-gradient-to-r from-orange-500 via-orange-400 to-amber-400 text-white shadow-2xl">
              <div className="max-w-7xl mx-auto px-6 py-6 flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="bg-white/20 p-3 rounded-2xl">
                    <span className="text-3xl">‚òÄÔ∏è</span>
                  </div>
                  <div>
                    <h1 className="text-3xl font-black">SOLAIRE FACILE</h1>
                    <p className="text-orange-100 text-sm">G√©n√©rateur V2 ‚Ä¢ Mapbox Edition</p>
                  </div>
                </div>
                <div className="text-right text-sm">
                  <p className="font-semibold">{COMPANY.adresse}</p>
                  <p className="text-orange-100">
                    {COMPANY.cp} {COMPANY.ville}
                  </p>
                </div>
              </div>
            </header>

            <nav className="bg-white/80 backdrop-blur-md border-b border-orange-200 sticky top-0 z-50">
              <div className="max-w-7xl mx-auto px-6 flex gap-1 py-2">
                {tabs.map((t, i) => (
                  <button
                    key={i}
                    onClick={() => setTab(i)}
                    className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                      tab === i
                        ? "bg-gradient-to-r from-orange-500 to-amber-500 text-white shadow-lg scale-105"
                        : "text-gray-600 hover:bg-orange-100"
                    }`}
                  >
                    {t}
                  </button>
                ))}
              </div>
            </nav>

            <main className="max-w-7xl mx-auto px-6 py-8">
              {tab === 0 && (
                <div className="space-y-8">
                  <section className="bg-white rounded-3xl shadow-xl p-8 border border-orange-100">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6">üñºÔ∏è Logo Client</h2>
                    <div
                      onDrop={handleLogo}
                      onDragOver={(e) => e.preventDefault()}
                      onClick={() => fileRef.current?.click()}
                      className={`border-3 border-dashed rounded-2xl p-8 text-center cursor-pointer ${
                        logo ? "border-green-400 bg-green-50" : "border-orange-300 hover:border-orange-500"
                      }`}
                    >
                      {logo ? (
                        <div className="relative inline-block">
                          <img src={logo} alt="Logo" className="max-h-32 rounded-lg" />
                          <button
                            onClick={(e) => {
                              e.stopPropagation();
                              setLogo(null);
                            }}
                            className="absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full text-xs"
                          >
                            ‚úï
                          </button>
                        </div>
                      ) : (
                        <>
                          <div className="text-4xl mb-2">üì§</div>
                          <p>Glissez-d√©posez ou cliquez</p>
                        </>
                      )}
                      <input ref={fileRef} type="file" accept="image/*" onChange={handleLogo} className="hidden" />
                    </div>
                  </section>

                  <section className="bg-white rounded-3xl shadow-xl p-8 border border-orange-100">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6">üë§ Informations Client</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div>
                        <label className="block text-sm font-semibold mb-2">Civilit√©</label>
                        <select
                          value={form.client.civilite}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, civilite: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                        >
                          <option>M.</option>
                          <option>Mme</option>
                          <option>M. et Mme</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Nom</label>
                        <input
                          value={form.client.nom}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, nom: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                          placeholder="Dupont"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Pr√©nom</label>
                        <input
                          value={form.client.prenom}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, prenom: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                          placeholder="Jean"
                        />
                      </div>
                    </div>
                    <div className="mt-6 relative">
                      <label className="block text-sm font-semibold mb-2">üìç Adresse</label>
                      <input
                        value={form.client.adresse}
                        onChange={(e) => {
                          setForm((p) => ({ ...p, client: { ...p.client, adresse: e.target.value } }));
                          searchAddr(e.target.value);
                        }}
                        onFocus={() => suggestions.length > 0 && setShowSugg(true)}
                        className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                        placeholder="Tapez l'adresse..."
                      />
                      {showSugg && suggestions.length > 0 && (
                        <div className="absolute z-50 w-full mt-2 bg-white rounded-xl shadow-2xl border overflow-hidden">
                          {suggestions.map((s, i) => (
                            <button
                              key={i}
                              onClick={() => selectAddr(s)}
                              className="w-full px-4 py-3 text-left hover:bg-orange-50 flex items-center gap-3"
                            >
                              <span>üìç</span>
                              {s.properties.label}
                            </button>
                          ))}
                        </div>
                      )}
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                      <div>
                        <label className="block text-sm font-semibold mb-2">Code Postal</label>
                        <input
                          value={form.client.cp}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, cp: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Ville</label>
                        <input
                          value={form.client.ville}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, ville: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">üìû T√©l√©phone</label>
                        <input
                          value={form.client.tel}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, tel: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                          placeholder="06 12 34 56 78"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">‚úâÔ∏è Email</label>
                        <input
                          value={form.client.email}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, email: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                          placeholder="email@exemple.fr"
                        />
                      </div>
                    </div>
                  </section>

                  <section className="bg-white rounded-3xl shadow-xl p-8 border border-orange-100">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6">üè† Logement</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div>
                        <label className="block text-sm font-semibold mb-2">Type</label>
                        <select
                          value={form.client.type}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, type: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                        >
                          <option>Maison individuelle</option>
                          <option>Appartement</option>
                          <option>B√¢timent commercial</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Surface (m¬≤)</label>
                        <input
                          type="number"
                          value={form.client.surface}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, surface: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                          placeholder="120"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Occupants</label>
                        <input
                          type="number"
                          value={form.client.occupants}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, occupants: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                          placeholder="4"
                        />
                      </div>
                      <div className="md:col-span-2">
                        <label className="block text-sm font-semibold mb-2">‚ö° Consommation annuelle (kWh)</label>
                        <input
                          type="number"
                          value={form.client.conso}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, conso: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                          placeholder="8500"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Construction</label>
                        <input
                          type="number"
                          value={form.client.annee}
                          onChange={(e) => setForm((p) => ({ ...p, client: { ...p.client, annee: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                          placeholder="1990"
                        />
                      </div>
                    </div>
                  </section>

                  <section className="bg-gradient-to-r from-orange-500 to-amber-500 rounded-3xl shadow-xl p-8 text-white">
                    <h2 className="text-2xl font-bold mb-6">üë§ Conseiller</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div>
                        <label className="block text-sm font-semibold text-orange-100 mb-2">Nom</label>
                        <input
                          value={form.conseiller.nom}
                          onChange={(e) => setForm((p) => ({ ...p, conseiller: { ...p.conseiller, nom: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl bg-white/20 border-2 border-white/30 text-white placeholder-white/60"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-orange-100 mb-2">T√©l√©phone</label>
                        <input
                          value={form.conseiller.telephone}
                          onChange={(e) => setForm((p) => ({ ...p, conseiller: { ...p.conseiller, telephone: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl bg-white/20 border-2 border-white/30 text-white placeholder-white/60"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-orange-100 mb-2">Email</label>
                        <input
                          value={form.conseiller.email}
                          onChange={(e) => setForm((p) => ({ ...p, conseiller: { ...p.conseiller, email: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl bg-white/20 border-2 border-white/30 text-white placeholder-white/60"
                        />
                      </div>
                    </div>
                  </section>
                </div>
              )}

              {tab === 1 && (
                <div className="space-y-8">
                  <section className="bg-white rounded-3xl shadow-xl overflow-hidden border border-orange-100">
                    <div className="p-6 border-b flex items-center justify-between">
                      <h2 className="text-2xl font-bold text-gray-800">üó∫Ô∏è Vue Satellite Mapbox</h2>
                      <div className="flex gap-2">
                        {mapStyles.slice(0, 4).map((style) => (
                          <button
                            key={style.id}
                            onClick={() => setMapStyle(style.id)}
                            className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                              mapStyle === style.id
                                ? "bg-orange-500 text-white"
                                : "bg-gray-100 text-gray-600 hover:bg-gray-200"
                            }`}
                          >
                            {style.name}
                          </button>
                        ))}
                      </div>
                    </div>
                    <div className="h-[500px]">
                      <MapboxMap lat={form.tech.coords.lat} lng={form.tech.coords.lng} zoom={18} styleId={mapStyle} />
                    </div>
                    {form.tech.coords.lat && (
                      <div className="p-4 bg-gradient-to-r from-orange-50 to-amber-50 border-t flex items-center justify-between">
                        <div className="flex items-center gap-4">
                          <span className="text-2xl">üìç</span>
                          <div>
                            <p className="font-semibold">{form.client.adresse}</p>
                            <p className="text-sm text-gray-500">
                              GPS: {form.tech.coords.lat.toFixed(6)}, {form.tech.coords.lng.toFixed(6)}
                            </p>
                          </div>
                        </div>
                        <div className="text-right">
                          <p className="text-xs text-gray-400">Powered by</p>
                          <p className="font-bold text-blue-600">Mapbox</p>
                        </div>
                      </div>
                    )}
                  </section>

                  <section className="bg-white rounded-3xl shadow-xl p-8 border border-orange-100">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6">üè† Toiture</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div>
                        <label className="block text-sm font-semibold mb-2">Orientation</label>
                        <select
                          value={form.tech.orientation}
                          onChange={(e) => setForm((p) => ({ ...p, tech: { ...p.tech, orientation: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                        >
                          <option>Sud</option>
                          <option>Sud-Est</option>
                          <option>Sud-Ouest</option>
                          <option>Est</option>
                          <option>Ouest</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Inclinaison: {form.tech.inclinaison}¬∞</label>
                        <input
                          type="range"
                          min="0"
                          max="90"
                          value={form.tech.inclinaison}
                          onChange={(e) => setForm((p) => ({ ...p, tech: { ...p.tech, inclinaison: +e.target.value } }))}
                          className="w-full"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Type</label>
                        <select
                          value={form.tech.toiture}
                          onChange={(e) => setForm((p) => ({ ...p, tech: { ...p.tech, toiture: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                        >
                          <option>Tuiles</option>
                          <option>Ardoises</option>
                          <option>Bac acier</option>
                          <option>Terrasse</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Surface dispo (m¬≤)</label>
                        <input
                          type="number"
                          value={form.tech.surfaceDispo}
                          onChange={(e) => setForm((p) => ({ ...p, tech: { ...p.tech, surfaceDispo: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                          placeholder="40"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Ombrage</label>
                        <select
                          value={form.tech.ombrage}
                          onChange={(e) => setForm((p) => ({ ...p, tech: { ...p.tech, ombrage: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                        >
                          <option>Aucun</option>
                          <option>Faible</option>
                          <option>Mod√©r√©</option>
                          <option>Important</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Branchement</label>
                        <select
                          value={form.tech.branchement}
                          onChange={(e) => setForm((p) => ({ ...p, tech: { ...p.tech, branchement: e.target.value } }))}
                          className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                        >
                          <option>Monophas√©</option>
                          <option>Triphas√©</option>
                        </select>
                      </div>
                    </div>
                  </section>

                  <section className="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-3xl shadow-xl p-8 text-white">
                    <div className="flex items-center justify-between mb-6">
                      <h2 className="text-2xl font-bold">‚òÄÔ∏è Calcul PVGIS</h2>
                      <button
                        onClick={fetchPVGIS}
                        disabled={pvgisLoading || !form.tech.coords.lat}
                        className="bg-white text-blue-600 px-6 py-3 rounded-xl font-bold hover:bg-blue-50 disabled:opacity-50"
                      >
                        {pvgisLoading ? "Calcul..." : "‚ö° Calculer"}
                      </button>
                    </div>
                    {pvgis ? (
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                        {[
                          ["Production/an", pvgis.prod.toFixed(0), "kWh/kWc"],
                          ["Irradiation", pvgis.irrad.toFixed(0), "kWh/m¬≤"],
                          ["Pertes", pvgis.pertes.toFixed(1), "%"],
                          ["Performance", (100 - pvgis.pertes).toFixed(0), "%"],
                        ].map((d, i) => (
                          <div key={i} className="bg-white/20 rounded-2xl p-6 text-center">
                            <p className="text-blue-100 text-sm mb-2">{d[0]}</p>
                            <p className="text-4xl font-black">{d[1]}</p>
                            <p className="text-blue-200">{d[2]}</p>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <div className="bg-white/10 rounded-2xl p-8 text-center">
                        <div className="text-4xl mb-4">‚ö†Ô∏è</div>
                        <p>S√©lectionnez une adresse puis cliquez Calculer</p>
                      </div>
                    )}
                  </section>
                </div>
              )}

              {tab === 2 && (
                <div className="space-y-8">
                  <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    {[
                      { k: "s1", n: "Essentiel", p: 3, pan: 8, c: "from-emerald-500 to-teal-500" },
                      { k: "s2", n: "Confort", p: 6, pan: 16, c: "from-orange-500 to-amber-500", rec: true },
                      { k: "s3", n: "Premium", p: 9, pan: 24, c: "from-purple-500 to-indigo-500" },
                    ].map((sc) => {
                      const f = calcFin(sc.p),
                        sel = form.scenarios[sc.k].selected;
                      return (
                        <div
                          key={sc.k}
                          onClick={() =>
                            setForm((p) => ({
                              ...p,
                              scenarios: { s1: { selected: sc.k === "s1" }, s2: { selected: sc.k === "s2" }, s3: { selected: sc.k === "s3" } },
                            }))
                          }
                          className={`relative bg-white rounded-3xl shadow-xl overflow-hidden cursor-pointer transition-all hover:shadow-2xl ${
                            sel ? "ring-4 ring-orange-400 scale-105" : ""
                          }`}
                        >
                          {sc.rec && (
                            <div className="absolute top-4 right-4 bg-orange-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                              RECOMMAND√â
                            </div>
                          )}
                          {sel && <div className="absolute top-4 left-4 bg-green-500 text-white p-2 rounded-full text-xs">‚úì</div>}
                          <div className={`bg-gradient-to-r ${sc.c} p-6 text-white`}>
                            <h3 className="text-2xl font-bold">{sc.n}</h3>
                            <p className="text-white/80">
                              {sc.p} kWc - {sc.pan} panneaux
                            </p>
                          </div>
                          <div className="p-6 space-y-3">
                            {[
                              ["Production", `${f.prod.toLocaleString("fr-FR")} kWh`],
                              ["Co√ªt", `${f.cout.toLocaleString("fr-FR")} ‚Ç¨`],
                              ["Prime", `-${f.prime.toLocaleString("fr-FR")} ‚Ç¨`, "text-green-600"],
                              ["Apr√®s aide", `${f.apresAide.toLocaleString("fr-FR")} ‚Ç¨`, "text-orange-600 text-xl"],
                              ["√âconomie/an", `+${f.rev.toFixed(0)} ‚Ç¨`, "text-green-600"],
                              ["ROI", `${f.roi.toFixed(1)} ans`],
                            ].map((r, i) => (
                              <div key={i} className="flex justify-between py-2 border-b">
                                <span className="text-gray-600">{r[0]}</span>
                                <span className={`font-bold ${r[2] || ""}`}>{r[1]}</span>
                              </div>
                            ))}
                            <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 mt-4">
                              <div className="flex justify-between">
                                <span className="text-green-700 font-semibold">√âconomie 25 ans</span>
                                <span className="font-black text-xl text-green-600">{f.eco25.toLocaleString("fr-FR")} ‚Ç¨</span>
                              </div>
                              <div className="flex items-center gap-2 mt-2 text-green-600">
                                <span>üå±</span>
                                <span className="text-sm">{(f.co2 / 1000).toFixed(1)} t CO‚ÇÇ/an</span>
                              </div>
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  {pvgis && (
                    <section className="bg-white rounded-3xl shadow-xl p-8 border border-orange-100">
                      <h2 className="text-2xl font-bold text-gray-800 mb-6">üìä Production Mensuelle</h2>
                      <div className="h-64 flex items-end justify-between gap-2">
                        {(pvgis.monthly || []).map((m, i) => {
                          const max = Math.max(...(pvgis.monthly || []).map((x) => x.E_m || x));
                          const v = m.E_m || m,
                            h = (v / max) * 100;
                          return (
                            <div key={i} className="flex-1 flex flex-col items-center">
                              <div className="w-full bg-gradient-to-t from-orange-500 to-amber-400 rounded-t-lg" style={{ height: `${h}%` }} />
                              <span className="text-xs text-gray-500 mt-2">{["J", "F", "M", "A", "M", "J", "J", "A", "S", "O", "N", "D"][i]}</span>
                            </div>
                          );
                        })}
                      </div>
                    </section>
                  )}
                </div>
              )}

              {tab === 3 && (
                <div className="space-y-8">
                  <section className="bg-white rounded-3xl shadow-xl p-8 border border-orange-100">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6">üìÑ Options Export</h2>
                    <div className="space-y-4">
                      {[
                        ["financement", "Options financement", "Cr√©dit, leasing, comptant"],
                        ["aides", "D√©tail aides", "Prime, TVA, locales"],
                        ["simulation", "Simulation d√©taill√©e", "Graphiques 25 ans"],
                        ["contrat", "Conditions g√©n√©rales", "CGV, garanties"],
                      ].map((o) => (
                        <label
                          key={o[0]}
                          className="flex items-start gap-4 p-4 rounded-xl border-2 border-gray-200 cursor-pointer hover:border-orange-300"
                        >
                          <input
                            type="checkbox"
                            checked={form.export[o[0]]}
                            onChange={(e) => setForm((p) => ({ ...p, export: { ...p.export, [o[0]]: e.target.checked } }))}
                            className="w-5 h-5 mt-1"
                          />
                          <div>
                            <p className="font-semibold">{o[1]}</p>
                            <p className="text-sm text-gray-500">{o[2]}</p>
                          </div>
                        </label>
                      ))}
                    </div>
                    <div className="mt-8">
                      <label className="block text-sm font-semibold mb-2">Validit√© (jours)</label>
                      <select
                        value={form.export.validite}
                        onChange={(e) => setForm((p) => ({ ...p, export: { ...p.export, validite: +e.target.value } }))}
                        className="w-full md:w-64 px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400"
                      >
                        <option value={15}>15</option>
                        <option value={30}>30</option>
                        <option value={45}>45</option>
                        <option value={60}>60</option>
                      </select>
                    </div>
                    <div className="mt-8">
                      <label className="block text-sm font-semibold mb-2">Notes</label>
                      <textarea
                        value={form.export.notes}
                        onChange={(e) => setForm((p) => ({ ...p, export: { ...p.export, notes: e.target.value } }))}
                        rows={4}
                        className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400 resize-none"
                        placeholder="Notes..."
                      />
                    </div>
                  </section>
                  <button
                    onClick={generatePDF}
                    disabled={generating}
                    className="w-full bg-gradient-to-r from-orange-500 to-amber-500 text-white py-5 rounded-2xl font-bold text-xl shadow-xl hover:shadow-2xl disabled:opacity-50 flex items-center justify-center gap-3"
                  >
                    {generating ? "‚è≥ G√©n√©ration..." : "üì• G√©n√©rer PDF 33 pages (Mapbox)"}
                  </button>
                </div>
              )}

              {tab === 4 && (
                <section className="bg-white rounded-3xl shadow-xl p-8 border border-orange-100">
                  <h2 className="text-2xl font-bold text-gray-800 mb-6">üìë Structure PDF (33 pages)</h2>
                  <div className="space-y-3">
                    {[
                      ["1", "Couverture"],
                      ["2", "Sommaire"],
                      ["3-4", "Pr√©sentation"],
                      ["5-6", "Pourquoi solaire"],
                      ["7-8", "Fiche client"],
                      ["9-10", "Analyse technique"],
                      ["11-12", "Vue satellite Mapbox üó∫Ô∏è"],
                      ["13-15", "PVGIS"],
                      ["16-18", "Sc√©nario Essentiel"],
                      ["19-21", "Sc√©nario Confort"],
                      ["22-24", "Sc√©nario Premium"],
                      ["25-26", "Comparatif"],
                      ["27-28", "Aides"],
                      ["29-30", "Financement"],
                      ["31", "Garanties"],
                      ["32", "Prochaines √©tapes"],
                      ["33", "Contact"],
                    ].map((s, i) => (
                      <div
                        key={i}
                        className="flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-orange-50 to-amber-50 hover:from-orange-100"
                      >
                        <div className="bg-orange-500 text-white px-3 py-1 rounded-lg font-bold text-sm min-w-16 text-center">
                          {s[0]}
                        </div>
                        <div className="flex-1 font-semibold">{s[1]}</div>
                        <span className="text-orange-400">‚Üí</span>
                      </div>
                    ))}
                  </div>
                </section>
              )}
            </main>

            <footer className="bg-gray-900 text-white py-8 mt-12">
              <div className="max-w-7xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-4">
                <div className="flex items-center gap-3">
                  <span className="text-2xl">‚òÄÔ∏è</span>
                  <div>
                    <p className="font-bold">SOLAIRE FACILE</p>
                    <p className="text-sm text-gray-400">
                      {COMPANY.adresse}, {COMPANY.cp} {COMPANY.ville}
                    </p>
                  </div>
                </div>
                <div className="text-center md:text-right">
                  <p className="text-sm text-gray-400">Cartes: Mapbox üó∫Ô∏è</p>
                  <p className="text-sm text-gray-400">G√©n√©rateur V2</p>
                </div>
              </div>
            </footer>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<SolaireFacileGenerator />);
    </script>
  </body>
</html>
